# 更新日志

## v1.0.0 - 2024-12-03

### ✨ 新增功能

#### 1. **图片自动上传**
- 支持从 URL 自动下载图片
- 自动上传到小红书发布页面
- 支持多张图片批量上传
- 实时显示下载和上传进度

**使用方法：**
在 `source/mock.json` 中配置图片 URL：
```json
{
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ]
}
```

**支持的图片格式：**
- JPEG/JPG
- PNG
- GIF
- WebP

**注意事项：**
- 图片 URL 必须可公开访问
- 建议使用支持 CORS 的图片源
- 图片会自动命名为 `image-1.jpg`, `image-2.jpg` 等

#### 2. **智能标签添加**
- 自动输入 `#` 唤起话题面板
- 在话题输入框中输入标签名
- 模拟按下 Enter 键确认标签
- 支持添加多个标签

**使用方法：**
在 `source/mock.json` 中配置标签（不需要 # 号）：
```json
{
  "tags": ["标签1", "标签2", "标签3"]
}
```

#### 3. **智能商品选择**
- 自动打开商品选择弹窗
- 使用搜索框查找商品
- 自动选中匹配的商品
- **有匹配商品** → 点击"保存"
- **无匹配商品** → 点击"取消"

**使用方法：**
在 `source/mock.json` 中配置商品 ID：
```json
{
  "commodityId": ["商品ID1", "商品ID2"]
}
```

### 🔧 优化改进

1. **标题填充**
   - ✅ 支持 React 输入框
   - ✅ 自动聚焦和事件触发
   - ✅ 限制 20 字以内

2. **正文填充**
   - ✅ 支持 textarea 和 contenteditable
   - ✅ 纯文本内容，标签独立处理
   - ✅ 正确触发 React 事件

3. **脚本加载检测**
   - ✅ 自动检测 content script 是否加载
   - ✅ 未加载时自动注入
   - ✅ 更可靠的消息通信

### 📋 完整配置示例

```json
{
  "title": "像是打翻了上帝的调色盘，这也太梦幻了吧！",
  "content": "救命！这组油画感纹理真的美到失语😭 每一张都像是流动的极光，又像是融化的冰淇淋🍦 粉紫与海盐蓝的碰撞，满满的高级感✨",
  "images": [
    "https://picsum.photos/800/1200?random=1",
    "https://picsum.photos/800/1200?random=2"
  ],
  "tags": ["油画感纹理", "高级感", "粉紫与海盐蓝的碰撞"],
  "commodityId": ["692f974c14b5260001d74b8c", "692bfa6195624300017df275"]
}
```

### 🎯 执行流程

1. **检测页面** → 确认在小红书发布页面
2. **加载数据** → 读取 `mock.json` 配置
3. **等待就绪** → 等待页面元素加载完成
4. **上传图片** → 下载并上传图片（2-5秒）
5. **填充标题** → 自动填充标题内容
6. **填充正文** → 自动填充正文内容
7. **添加标签** → 逐个添加话题标签
8. **选择商品** → 搜索并选择商品
9. **完成提示** → 显示成功提示

**总耗时：** 约 10-15 秒（取决于图片数量）

### 🐛 已知问题

1. **图片下载可能失败**
   - 原因：图片 URL 不可访问或 CORS 限制
   - 解决：使用支持 CORS 的图片源，或使用本地图片

2. **标签面板可能不出现**
   - 原因：页面结构变化或网络延迟
   - 解决：增加等待时间或手动添加标签

3. **商品可能搜索不到**
   - 原因：商品 ID 不正确或商品不在库中
   - 解决：检查商品 ID，插件会自动点击取消

### 💡 使用技巧

#### 技巧 1：本地图片上传
如果你的图片在本地，可以：
1. 先上传到支持 CORS 的图床（如 imgur.com）
2. 或者使用 `file://` 协议（需要额外配置）

#### 技巧 2：测试图片 URL
使用测试图片服务：
- Picsum Photos: `https://picsum.photos/800/1200?random=1`
- Lorem Picsum: `https://source.unsplash.com/random/800x1200`
- Placeholder: `https://via.placeholder.com/800x1200`

#### 技巧 3：跳过图片上传
如果暂时不需要图片，可以：
```json
{
  "images": []
}
```
或者删除 `images` 字段

#### 技巧 4：调试模式
打开 Console (F12) 查看详细日志：
- `📸 正在准备图片...` - 开始上传
- `📥 下载图片 1/2...` - 下载进度
- `✅ 图片 1 下载完成` - 下载成功
- `📤 正在上传...` - 上传中
- `✅ 图片上传中，请稍候...` - 完成

### 🔄 下一步计划

- [ ] 支持本地图片路径
- [ ] 图片压缩和优化
- [ ] 批量发布功能
- [ ] 内容模板管理
- [ ] 定时发布
- [ ] 发布记录

---

## 反馈与支持

如有问题或建议，请查看 `GUIDE.md` 或提交 Issue。

